steps:

# BACKEND

- id: 'backend-build'
  waitFor: ['-']
  name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', 'gcr.io/$PROJECT_ID/backend:$COMMIT_SHA', 'backend']

- id: 'backend-push'
  waitFor: ['backend-build']
  name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/$PROJECT_ID/backend:$COMMIT_SHA']

# FRONTEND

- id: 'frontend-build'
  waitFor: ['-']
  name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', 'gcr.io/$PROJECT_ID/frontend:$COMMIT_SHA', 'frontend']

- id: 'frontend-push'
  waitFor: ['frontend-build']
  name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/$PROJECT_ID/frontend:$COMMIT_SHA']

# DEPLOYMENT

- waitFor: ['backend-push', 'frontend-push']
  name: 'gcr.io/cloud-builders/gcloud'
  entrypoint: 'bash'
  args:
  - '-c'
  - |
    echo noice
